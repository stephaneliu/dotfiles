#!/bin/bash

# Required parameters:
# @raycast.schemaVersion 1
# @raycast.title Create Image from Code
# @raycast.mode silent

# Optional parameters:
# @raycast.icon ./images/ray-so.png
# @raycast.argument1 { "type": "text", "placeholder": "Title", "optional": true }

# Documentation:
# @raycast.description Create beautiful images of your code with https://ray.so
# @raycast.author Thomas Paul Mann
# @raycast.authorURL https://github.com/thomaspaulmann

# Customization:

hour_of_day=$(date +"%H")
phase_of_day=0

declare -i hour_of_day

if [ $hour_of_day -lt 10 ]; then
  phase_of_day=1
elif [ $hour_of_day -gt 9 ] && [ $hour_of_day -lt 17 ]; then
  phase_of_day=2
elif [ $hour_of_day -gt 16 ] && [ $hour_of_day -lt 20 ]; then
  phase_of_day=3
else
  phase_of_day=4
fi
# echo "phase: $phase_of_day"

# Set colors. Available options: candy, breeze, midnight or sunset
# phase_of_day 1 - breeze
# phase_of_day 2 - candy
# phase_of_day 3 - sunset
# phase_of_day 4 - midnight
if [[ phase_of_day -eq 1 ]]; then
  COLORS="breeze"
elif [[ phase_of_day -eq 2 ]]; then
  COLORS="candy"
elif [[ phase_of_day -eq 3 ]]; then
  COLORS="sunset"
else
  COLORS="midnight"
fi
# echo "colors: $COLORS"

# Toggle dark mode. Available options: true or false
DARK_MODE="true"
# Toggle background. Available options: true or false
BACKGROUND="true"
# Set padding. Available options: 16, 32, 64 or 128
PADDING="64"
# Set language. Available options: shell, c-like (C++), csharp, clojure, coffeescript, crystal, css, d, dart, diff,
# dockerfile, elm, erlang, fortran, gherkin, go, groovy, haskell, xml, java, javascript, json, jsx, julia, kotlin,
# latex, lisp, lua, markdown, mathematica, octave, nginx, objectivec, ocaml (F#), perl, php,
# powershell, python, r, ruby, rust, scala, smalltalk, sql, swift, typescript, (for Tsx, use jsx), twig, verilog,
# vhdl, xquery, yaml
LANGUAGE=$2 || "auto"

# Main:

if [[ -z "$1" ]]
then
  TITLE="Untitled-1"
else
  TITLE=$(php -r "echo urlencode(\"$1\");")
fi

CODE=$(pbpaste | base64)
# Urlencode any + symbols in the base64 encoded string
CODE=${CODE//+/%2B}

open "https://ray.so/?colors=$COLORS&background=$BACKGROUND&darkMode=$DARK_MODE&padding=$PADDING&title=$TITLE&code=$CODE&language=$LANGUAGE"
